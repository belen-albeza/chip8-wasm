(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();let c;const q=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&q.decode();let y=null;function E(){return(y===null||y.byteLength===0)&&(y=new Uint8Array(c.memory.buffer)),y}function T(t,e){return t=t>>>0,q.decode(E().subarray(t,t+e))}const b=new Array(128).fill(void 0);b.push(void 0,null,!0,!1);let S=b.length;function u(t){S===b.length&&b.push(b.length+1);const e=S;return S=b[e],b[e]=t,e}function a(t){return b[t]}function D(t){t<132||(b[t]=S,S=t)}function h(t){const e=a(t);return D(t),e}let g=0;function U(t,e){const n=e(t.length*1,1)>>>0;return E().set(t,n/1),g=t.length,n}let v=null;function f(){return(v===null||v.byteLength===0)&&(v=new Int32Array(c.memory.buffer)),v}const x=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},W=typeof x.encodeInto=="function"?function(t,e){return x.encodeInto(t,e)}:function(t,e){const n=x.encode(t);return e.set(n),{read:t.length,written:n.length}};function C(t,e,n){if(n===void 0){const _=x.encode(t),l=e(_.length,1)>>>0;return E().subarray(l,l+_.length).set(_),g=_.length,l}let r=t.length,o=e(r,1)>>>0;const i=E();let s=0;for(;s<r;s++){const _=t.charCodeAt(s);if(_>127)break;i[o+s]=_}if(s!==r){s!==0&&(t=t.slice(s)),o=n(o,r,r=s+t.length*3,1)>>>0;const _=E().subarray(o+s,o+r),l=W(t,_);s+=l.written,o=n(o,r,s,1)>>>0}return g=s,o}function B(t){try{const o=c.__wbindgen_add_to_stack_pointer(-16),i=U(t,c.__wbindgen_malloc),s=g;c.loadRom(o,i,s);var e=f()[o/4+0],n=f()[o/4+1],r=f()[o/4+2];if(r)throw h(n);return k.__wrap(e)}finally{c.__wbindgen_add_to_stack_pointer(16)}}function d(t,e){try{return t.apply(this,e)}catch(n){c.__wbindgen_exn_store(u(n))}}const I=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>c.__wbg_emu_free(t>>>0));class k{static __wrap(e){e=e>>>0;const n=Object.create(k.prototype);return n.__wbg_ptr=e,I.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,I.unregister(this),e}free(){const e=this.__destroy_into_raw();c.__wbg_emu_free(e)}constructor(e){const n=U(e,c.__wbindgen_malloc),r=g,o=c.emu_new(n,r);return this.__wbg_ptr=o>>>0,this}run(e){try{const i=c.__wbindgen_add_to_stack_pointer(-16);c.emu_run(i,this.__wbg_ptr,e);var n=f()[i/4+0],r=f()[i/4+1],o=f()[i/4+2];if(o)throw h(r);return n!==0}finally{c.__wbindgen_add_to_stack_pointer(16)}}setTheme(e,n){try{const i=c.__wbindgen_add_to_stack_pointer(-16),s=C(e,c.__wbindgen_malloc,c.__wbindgen_realloc),_=g,l=C(n,c.__wbindgen_malloc,c.__wbindgen_realloc),A=g;c.emu_setTheme(i,this.__wbg_ptr,s,_,l,A);var r=f()[i/4+0],o=f()[i/4+1];if(o)throw h(r)}finally{c.__wbindgen_add_to_stack_pointer(16)}}displayBuffer(){return c.emu_displayBuffer(this.__wbg_ptr)>>>0}updateKeyState(e,n){try{const i=c.__wbindgen_add_to_stack_pointer(-16),s=C(e,c.__wbindgen_malloc,c.__wbindgen_realloc),_=g;c.emu_updateKeyState(i,this.__wbg_ptr,s,_,n);var r=f()[i/4+0],o=f()[i/4+1];if(o)throw h(r)}finally{c.__wbindgen_add_to_stack_pointer(16)}}isBuzzing(){return c.emu_isBuzzing(this.__wbg_ptr)!==0}}async function j(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function V(){const t={};return t.wbg={},t.wbg.__wbindgen_string_new=function(e,n){const r=T(e,n);return u(r)},t.wbg.__wbg_crypto_1d1f22824a6a080c=function(e){const n=a(e).crypto;return u(n)},t.wbg.__wbindgen_is_object=function(e){const n=a(e);return typeof n=="object"&&n!==null},t.wbg.__wbg_process_4a72847cc503995b=function(e){const n=a(e).process;return u(n)},t.wbg.__wbg_versions_f686565e586dd935=function(e){const n=a(e).versions;return u(n)},t.wbg.__wbindgen_object_drop_ref=function(e){h(e)},t.wbg.__wbg_node_104a2ff8d6ea03a2=function(e){const n=a(e).node;return u(n)},t.wbg.__wbindgen_is_string=function(e){return typeof a(e)=="string"},t.wbg.__wbg_require_cca90b1a94a0255b=function(){return d(function(){const e=module.require;return u(e)},arguments)},t.wbg.__wbg_msCrypto_eb05e62b530a1508=function(e){const n=a(e).msCrypto;return u(n)},t.wbg.__wbg_randomFillSync_5c9c955aa56b6049=function(){return d(function(e,n){a(e).randomFillSync(h(n))},arguments)},t.wbg.__wbg_getRandomValues_3aa56aa6edec874c=function(){return d(function(e,n){a(e).getRandomValues(a(n))},arguments)},t.wbg.__wbindgen_is_function=function(e){return typeof a(e)=="function"},t.wbg.__wbg_newnoargs_e258087cd0daa0ea=function(e,n){const r=new Function(T(e,n));return u(r)},t.wbg.__wbg_call_27c0f87801dedf93=function(){return d(function(e,n){const r=a(e).call(a(n));return u(r)},arguments)},t.wbg.__wbg_self_ce0dbfc45cf2f5be=function(){return d(function(){const e=self.self;return u(e)},arguments)},t.wbg.__wbg_window_c6fb939a7f436783=function(){return d(function(){const e=window.window;return u(e)},arguments)},t.wbg.__wbg_globalThis_d1e6af4856ba331b=function(){return d(function(){const e=globalThis.globalThis;return u(e)},arguments)},t.wbg.__wbg_global_207b558942527489=function(){return d(function(){const e=global.global;return u(e)},arguments)},t.wbg.__wbindgen_is_undefined=function(e){return a(e)===void 0},t.wbg.__wbg_call_b3ca7c6051f9bec1=function(){return d(function(e,n,r){const o=a(e).call(a(n),a(r));return u(o)},arguments)},t.wbg.__wbg_buffer_12d079cc21e14bdb=function(e){const n=a(e).buffer;return u(n)},t.wbg.__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb=function(e,n,r){const o=new Uint8Array(a(e),n>>>0,r>>>0);return u(o)},t.wbg.__wbg_new_63b92bc8671ed464=function(e){const n=new Uint8Array(a(e));return u(n)},t.wbg.__wbg_set_a47bac70306a19a7=function(e,n,r){a(e).set(a(n),r>>>0)},t.wbg.__wbg_newwithlength_e9b4878cebadb3d3=function(e){const n=new Uint8Array(e>>>0);return u(n)},t.wbg.__wbg_subarray_a1f73cd4b5b42fe1=function(e,n,r){const o=a(e).subarray(n>>>0,r>>>0);return u(o)},t.wbg.__wbindgen_object_clone_ref=function(e){const n=a(e);return u(n)},t.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return u(e)},t.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const r=a(n).stack,o=C(r,c.__wbindgen_malloc,c.__wbindgen_realloc),i=g;f()[e/4+1]=i,f()[e/4+0]=o},t.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let r,o;try{r=e,o=n,console.error(T(e,n))}finally{c.__wbindgen_free(r,o,1)}},t.wbg.__wbindgen_throw=function(e,n){throw new Error(T(e,n))},t.wbg.__wbindgen_memory=function(){const e=c.memory;return u(e)},t}function G(t,e){return c=t.exports,N.__wbindgen_wasm_module=e,v=null,y=null,c}async function N(t){if(c!==void 0)return c;typeof t>"u"&&(t=new URL("/chip8-wasm/assets/chip8_bg-cEV6C0NT.wasm",import.meta.url));const e=V();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:n,module:r}=await j(await t,e);return G(n,r)}const P=.08;class K{ctx;osc;gainNode;constructor(){this.ctx=new AudioContext,this.gainNode=this.ctx.createGain(),this.gainNode.connect(this.ctx.destination),this.gainNode.gain.value=P}play(){this.osc||(this.osc=this.ctx.createOscillator(),this.osc.type="square",this.osc.frequency.value=261.63,this.osc.connect(this.gainNode),this.osc.start())}stop(){this.osc&&(this.osc.stop(),this.osc.disconnect(),this.osc=void 0)}mute(){this.gainNode.gain.value=0}unmute(){this.gainNode.gain.value=P}}const H=[{name:"poker.ch8",url:"/roms/poker.ch8"},{name:"wait_for_key.ch8",url:"/roms/wait_for_key.ch8"},{name:"buzz.ch8",url:"/roms/buzz.ch8"}],Y=64*32,z=[{name:"Noire Truth",off:"#1e1c32",on:"#c6baac"},{name:"1-bit Monitor Glow",off:"#222323",on:"#f0f6f0"},{name:"Paperback-2",off:"#382b26",on:"#b8c2b9"},{name:"Gato Roboto Goop",off:"#210009",on:"#00ffae"},{name:"Y's Postapocalyptic Sunset",off:"#1d0f44",on:"#f44e38"}];let L,R,F,m;const w={cyclesPerFrame:12,theme:z[0]};$();async function $(){X(H),Z()}function J(t){const e=document.querySelector("#chip8-config-theme-selector"),n=r=>{const o=parseInt(r.target.value);w.theme=z[o],t.setTheme(w.theme.off,w.theme.on)};return e?.addEventListener("change",n),()=>{e?.removeEventListener("change",n)}}async function Q(t){R=new AbortController,F=new AbortController,m||(m=new K);const e=await N(),n=await te(t),r=J(n);n.setTheme(w.theme.off,w.theme.on),document.addEventListener("keydown",p=>{n.updateKeyState(p.code,!0)},{signal:R.signal}),document.addEventListener("keyup",p=>{n.updateKeyState(p.code,!1)},{signal:F.signal});const o=()=>{r(),m?.stop(),R?.abort(),F?.abort(),L&&cancelAnimationFrame(L)},i=new Uint8Array(e.memory.buffer),s=document.querySelector("#chip8-canvas"),_=s?.getContext("2d");if(!_||!s)throw new Error("Valid canvas not found");const l=_.createImageData(s.width,s.height),A=()=>{let p=n.run(w.cyclesPerFrame);n.isBuzzing()?m?.play():m?.stop();const O=n.displayBuffer(),M=i.slice(O,O+4*Y);l.data.set(M),_.putImageData(l,0,0),p?(console.debug("Chip-8 VM halted"),o()):L=requestAnimationFrame(A)};return A(),o}function X(t){const e=document.querySelector("#chip8-rom-selector");for(const{name:r,url:o}of t){const i=new Option;i.value=o,i.innerHTML=r,e?.appendChild(i)}let n;e?.addEventListener("change",async()=>{n&&await n();let r=e.value;n=await Q(r)})}function Z(){const t=document.querySelector("#chip8-ipf-selector");t.value=w.cyclesPerFrame.toString(),t.addEventListener("change",()=>{const i=parseInt(t.value);w.cyclesPerFrame=i,e()});const e=()=>{const i=document.querySelector("#chip8-config-ips"),s=w.cyclesPerFrame*60;i.textContent=s.toString()};e();const n=document.querySelector("#chip8-config-theme-selector");for(const[i,{name:s}]of z.entries()){const _=new Option;_.value=i.toString(),_.innerText=s,n?.appendChild(_)}const r=document.querySelector("#chip8-config-audio"),o=()=>{!!r?.checked?m?.unmute():m?.mute()};o(),r?.addEventListener("change",o)}async function ee(t){try{return await fetch(t)}catch(e){console.error(e)}}async function te(t){const e=await ee(t);if(!e)throw new Error(`Could not load rom: ${t}`);const n=await e.arrayBuffer(),r=new Uint8Array(n);return B(r)}
